<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Welcome to Synergist.Cloud | Region: eu-west-1</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="author" content="Balinder Walia - Synergist.cloud">
<meta name="generator" content="vi">
<meta name="keywords" content="Synergist cloud, cloud job bagging system, job costing system, Synergist, Balinder, Walia">
<meta name="description" content="nginx test page">
 <!-- Tell the browser to be responsive to screen width -->
 <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
 <!-- Bootstrap 3.3.6 -->
 <link rel="stylesheet" href="css/bootstrap.min.css">
 <!-- Font Awesome -->
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
 <!-- Ionicons -->
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
 <!-- Theme style -->
 <link rel="stylesheet" href="css/Admin.min.css">
   <link rel="stylesheet" href="css/basictable.css">
 <link rel="stylesheet" href="css/skins/_all-skins.min.css">
 </head>
<body class="hold-transition skin-blue sidebar-mini">
 <div class="wrapper">
 

  <header class="main-header">
    <!-- Logo -->
    <a href="index.html" class="logo">
      <!-- mini logo for sidebar mini 50x50 pixels -->
      <span class="logo-mini"><img src="images/jobshout-small.gif"  STYLE="padding-left:15px; "></span>
      <!-- logo for regular state and mobile devices -->
      <span class="logo-lg"><IMG SRC="images/webcrm-logo.png" ALT="" style="width:80%"/></span>
    </a>
    <!-- Header Navbar: style can be found in header.less -->
    <nav class="navbar navbar-static-top">
      <!-- Sidebar toggle button-->
      <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
        <span class="sr-only">Toggle navigation</span>
      </a>

      <div class="navbar-custom-menu">
        <ul class="nav navbar-nav">
          <!-- Messages: style can be found in dropdown.less-->
          <li class="dropdown messages-menu">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
              <i class="fa fa-envelope-o"></i>
              <span class="label label-success">4</span>
            </a>
            <ul class="dropdown-menu">
              <li class="header">You have 4 messages</li>
              <li>
                <!-- inner menu: contains the actual data -->
                <ul class="menu">
                  <li><!-- start message -->
                    <a href="#">
                      <div class="pull-left">
                        <img src="img/user2-160x160.jpg" class="img-circle" alt="User Image">
                      </div>
                      <h4>
                        Support Team
                        <small><i class="fa fa-clock-o"></i> 5 mins</small>
                      </h4>
                      <p>Why not buy a new awesome theme?</p>
                    </a>
                  </li>
                  <!-- end message -->
                  <li>
                    <a href="#">
                      <div class="pull-left">
                        <img src="img/user3-128x128.jpg" class="img-circle" alt="User Image">
                      </div>
                      <h4>
                        Design Team
                        <small><i class="fa fa-clock-o"></i> 2 hours</small>
                      </h4>
                      <p>Why not buy a new awesome theme?</p>
                    </a>
                  </li>
                  <li>
                    <a href="#">
                      <div class="pull-left">
                        <img src="img/user4-128x128.jpg" class="img-circle" alt="User Image">
                      </div>
                      <h4>
                        Developers
                        <small><i class="fa fa-clock-o"></i> Today</small>
                      </h4>
                      <p>Why not buy a new awesome theme?</p>
                    </a>
                  </li>
                  <li>
                    <a href="#">
                      <div class="pull-left">
                        <img src="img/user3-128x128.jpg" class="img-circle" alt="User Image">
                      </div>
                      <h4>
                        Sales Department
                        <small><i class="fa fa-clock-o"></i> Yesterday</small>
                      </h4>
                      <p>Why not buy a new awesome theme?</p>
                    </a>
                  </li>
                  <li>
                    <a href="#">
                      <div class="pull-left">
                        <img src="img/user4-128x128.jpg" class="img-circle" alt="User Image">
                      </div>
                      <h4>
                        Reviewers
                        <small><i class="fa fa-clock-o"></i> 2 days</small>
                      </h4>
                      <p>Why not buy a new awesome theme?</p>
                    </a>
                  </li>
                </ul>
              </li>
              <li class="footer"><a href="#">See All Messages</a></li>
            </ul>
          </li>
          <!-- Notifications: style can be found in dropdown.less -->
          <li class="dropdown notifications-menu">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
              <i class="fa fa-bell-o"></i>
              <span class="label label-warning">10</span>
            </a>
            <ul class="dropdown-menu">
              <li class="header">You have 10 notifications</li>
              <li>
                <!-- inner menu: contains the actual data -->
                <ul class="menu">
                  <li>
                    <a href="#">
                      <i class="fa fa-users text-aqua"></i> 5 new members joined today
                    </a>
                  </li>
                  <li>
                    <a href="#">
                      <i class="fa fa-warning text-yellow"></i> Very long description here that may not fit into the
                      page and may cause design problems
                    </a>
                  </li>
                  <li>
                    <a href="#">
                      <i class="fa fa-users text-red"></i> 5 new members joined
                    </a>
                  </li>
                  <li>
                    <a href="#">
                      <i class="fa fa-shopping-cart text-green"></i> 25 sales made
                    </a>
                  </li>
                  <li>
                    <a href="#">
                      <i class="fa fa-user text-red"></i> You changed your username
                    </a>
                  </li>
                </ul>
              </li>
              <li class="footer"><a href="#">View all</a></li>
            </ul>
          </li>
          <!-- Tasks: style can be found in dropdown.less -->
          <li class="dropdown tasks-menu">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
              <i class="fa fa-file-o"></i>
              <span class="label label-danger">5</span>
            </a>
            <ul class="dropdown-menu">
              <li class="header">Switch Site to</li>
	        
	         <li STYLE="padding:15px;" >
                  
                      <input TYPE="text" CLASS="form-control"  STYLE="height:34px; border-radius:4px; border: 1px solid #ddd;">
                    
                   
                  </li>
              <li>
                <!-- inner menu: contains the actual data -->
                <ul class="menu">
                 
                  
                  <li>
                    <a href="#">
                      
                      Demo website
                    </a>
                  </li>
		    
		    
		    <li>
                    <a href="#">
                      
                      Demo website
                    </a>
                  </li>
		      
		      
		      
		      <li>
                    <a href="#">
                      
                      Demo website
                    </a>
                  </li>
		        
		        
		        
		        <li>
                    <a href="#">
                      
                      Demo website
                    </a>
                  </li>
			  
			  
			  
			  <li>
                    <a href="#">
                      
                      Demo website
                    </a>
                  </li>
			    
			    
			    
			    
			    <li>
                    <a href="#">
                      
                      Demo website
                    </a>
                  </li>
			      <li>
                    <a href="#">
                      
                     Testing website
                    </a>
                  </li>
			        
			        <li>
                    <a href="#">
                      
                     Live website
                    </a>
                  </li>
                 
               
                </ul>
              </li>
              
            </ul>
          </li>
          <!-- User Account: style can be found in dropdown.less -->
          <li class="dropdown user user-menu">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
              <img src="img/user2-160x160.jpg" class="user-image" alt="User Image">
              <span class="hidden-xs">Alexander Pierce</span>
            </a>
            <ul class="dropdown-menu">
              <!-- User image -->
              <li class="user-header">
                <img src="img/user2-160x160.jpg" class="img-circle" alt="User Image">

                <p>
                  Alexander Pierce - Web Developer
                  <small>Member since Nov. 2012</small>
                </p>
              </li>
              <!-- Menu Body -->
              <li class="user-body">
                <div class="row">
                  <div class="col-xs-4 text-center">
                    <a href="#">Followers</a>
                  </div>
                  <div class="col-xs-4 text-center">
                    <a href="#">Sales</a>
                  </div>
                  <div class="col-xs-4 text-center">
                    <a href="#">Friends</a>
                  </div>
                </div>
                <!-- /.row -->
              </li>
              <!-- Menu Footer-->
              <li class="user-footer">
                <div class="pull-left">
                  <a href="#" class="btn btn-default btn-flat">Profile</a>
                </div>
                <div class="pull-right">
                  <a href="#" class="btn btn-default btn-flat">Sign out</a>
                </div>
              </li>
            </ul>
          </li>
          <!-- Control Sidebar Toggle Button -->
                </ul>
      </div>
    </nav>
  </header>
  <!-- Left side column. contains the logo and sidebar -->
  <aside class="main-sidebar">
    <!-- sidebar: style can be found in sidebar.less -->
    <section class="sidebar">
      <!-- Sidebar user panel -->
      <div class="user-panel">
        <div class="pull-left image">
          <img src="img/user2-160x160.jpg" class="img-circle" alt="User Image">
        </div>
        <div class="pull-left info">
          <p>Alexander Pierce</p>
          <a href="#"><i class="fa fa-circle text-success"></i> Online</a>
        </div>
      </div>
      <!-- search form -->
      <form action="#" method="get" class="sidebar-form">
        <div class="input-group">
          <input type="text" name="q" class="form-control" placeholder="Search...">
              <span class="input-group-btn">
                <button type="submit" name="search" id="search-btn" class="btn btn-flat" STYLE="border-left:none;     line-height: 12px;"><i class="fa fa-search"></i>
                </button>
              </span>
        </div>
      </form>
      <!-- /.search form -->
      <!-- sidebar menu: : style can be found in sidebar.less -->
      <ul class="sidebar-menu">
      
        <li class="active treeview">
          <a href="index.html">
            <i class="fa fa-dashboard"></i> <span>Dashboard</span>
            <span class="pull-right-container">
              <i class="fa fa-angle-left pull-right"></i>
            </span>
          </a>
		  </li>
		  <li class=" treeview">
          <a href="#">
            <i class=" fa fa-list"></i> <span>Lists</span>
            <span class="pull-right-container">
              <i class="fa fa-angle-left pull-right"></i>
            </span>
          </a>
          <ul class="treeview-menu">
            <li class="active"><a href="lists.html"><i class="fa fa-circle-o"></i> Lists</a></li>
           	<li class="active"><a href="list.html"><i class="fa fa-circle-o"></i> Add New List</a></li>
          </ul>
        </li>
         <li class=" treeview">
          <a href="#">
            <i class=" fa fa-server"></i> <span>Hosts</span>
            <span class="pull-right-container">
              <i class="fa fa-angle-left pull-right"></i>
            </span>
          </a>
          <ul class="treeview-menu">
            <li class="active"><a href="hosts.html"><i class="fa fa-circle-o"></i> List Hosts</a></li>
           	<li class="active"><a href="host.html"><i class="fa fa-circle-o"></i> Add New Host</a></li>
          </ul>
        </li>
        <li class=" treeview">
          <a href="#">
            <i class="fa fa-life-ring"></i> <span>Rules</span>
            <span class="pull-right-container">
              <i class="fa fa-angle-left pull-right"></i>
            </span>
          </a>
          <ul class="treeview-menu">
            <li class="active"><a href="rules.html"><i class="fa fa-circle-o"></i> List Rules</a></li>
           	<li class="active"><a href="rule.html"><i class="fa fa-circle-o"></i> Add New Rule</a></li>
          </ul>
        </li>
        <li class=" treeview">
          <a href="#">
            <i class="fa fa-globe"></i> <span>Sites</span>
            <span class="pull-right-container">
              <i class="fa fa-angle-left pull-right"></i>
            </span>
          </a>
          <ul class="treeview-menu">
            <li class="active"><a href="sites.html"><i class="fa fa-circle-o"></i> List Sites</a></li>
           	<li class="active"><a href="site.html"><i class="fa fa-circle-o"></i> Add New Site</a></li>
          </ul>
        </li>
        <li class=" treeview">
          <a href="#">
            <i class=" fa fa-arrow-circle-o-up"></i> <span>Upstreams</span>
            <span class="pull-right-container">
              <i class="fa fa-angle-left pull-right"></i>
            </span>
          </a>
          <ul class="treeview-menu">
            <li class="active"><a href="upstreams.html"><i class="fa fa-circle-o"></i> List Upstreams </a></li>
           	<li class="active"><a href="upstream.html"><i class="fa fa-circle-o"></i> Add New Upstream</a></li>
          </ul>
        </li>
        <li class=" treeview">
          <a href="#">
            <i class="fa fa-globe"></i> <span>Urls</span>
            <span class="pull-right-container">
              <i class="fa fa-angle-left pull-right"></i>
            </span>
          </a>
          <ul class="treeview-menu">
            <li class="active"><a href="urls.html"><i class="fa fa-circle-o"></i> List Urls </a></li>
           	<li class="active"><a href="url_form.html"><i class="fa fa-circle-o"></i> Add New Url</a></li>
          </ul>
        </li>
		</ul>
    </section>
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>
        <span id="pageHeadingID">Add</span>
        <small>Site</small>
      </h1>
      <ol class="breadcrumb">
        <li><a href="index.html"><i class="fa fa-dashboard"></i> Home</a></li>
        <li class="active">Site</li>
      </ol>
    </section>

    <!-- Main content -->
    <section class="content">
       
      <form class="form-horizontal" id="EntryForm">
	 <div class="row">
             <div class=" col-sm-12 col-lg-12">
               <input type="hidden" class="form-control" id="rules" name="rules"/>
               <input type="hidden" class="form-control" id="hosts" name="hosts"/>
               <input type="hidden" class="form-control" id="uuid" name="uuid"/>
  <div class="form-group">
    <label for="" class="col-sm-1 control-label">Name<sup class="required">*</sup></label>
    <div class="col-sm-5 ">
       <input class="form-control required" id="name" placeholder="Name" name="name" type="text" onblur="generate_manual_code('name','code');" onkeyup="generate_manual_code('name','code');">
    </div>
    
    <label for="" class="col-sm-1 control-label">Code<sup class="required">*</sup></label>
    <div class="col-sm-5 ">
       <input class="form-control required" id="code" placeholder="Code" name="code" type="text">
       <span STYLE="font-size:12px; color:#737373;">Unique value</span>
    </div>
  </div><div class="form-group">
    <label for="" class="col-sm-1 control-label">SSL Certificate</label>
    <div class="col-sm-6 ">
       <input class="form-control" id="ssl_certificate" placeholder="SSL Certificate" name="ssl_certificate" type="text">
    </div>
  </div>
  <div class="form-group">
    <label for="" class="col-sm-1 control-label">SSL Certificate Key</label>
    <div class="col-sm-6 ">
       <input class="form-control" id="ssl_certificate_key" placeholder="SSL Certificate Key" name="ssl_certificate_key" type="text">
    </div>
  </div>
  
  <div CLASS="ROW host_details_class" style="display:none;">
    <div CLASS="col-md-12 itemsContent" STYLE="margin-left:13px;">
      <span style="float:right; font-weight:bold;">
	<button type="button" class="btn btn-danger" data-toggle="modal" data-target="#hostDetailsModules" style="margin-bottom: 10px;">+ Add new host details</button>
	</span>
      </div>
    </div>
    
  <div CLASS="row host_details_class" style="display:none;">
    <div class="itemsContent col-md-12" id="itemsTable">
      <label for="" class="col-lg-1 col-sm-12 control-label" STYLE="padding-left:0px;">Host Details</label>
      <div >
	<div CLASS="table-responsive">
	  <table class="table table-striped  table-bordered table-hover custom-tbl-st bt" id="hosts_table">
	    <thead>
	      <tr class="item">
		<th>Host Name</th>
		<th>IP Address</th>
		<th>Index</th>
		<th>Port</th>
		<th>Redirect to HTTPS</th>
		<th>Root Path</th>
		<th>Access Log Path</th>
		<th>Error Log Path</th>
		<th colspan="2" align="center">Actions</th>
		</tr>
	      </thead>
	    <tbody id="host_items">
	      
	        </tbody>
	    </table>
	  </div>
	
	</div>
      </div>
    </div>
  <div CLASS="ROW ">
    <div CLASS="col-md-12 itemsContent" STYLE="margin-left:13px;">
      <span style="float:right; font-weight:bold;">
	<button type="button" class="btn btn-danger" data-toggle="modal" data-target="#myModal" style="margin-bottom: 10px;">+ Add new Rule</button>
	</span>
      </div>
    </div>
  <div CLASS="row">
    <div class="itemsContent col-md-12" id="itemsTable">
      <label for="" class="col-lg-1 col-sm-12 control-label" STYLE="padding-left:0px;">Rewrite Rules</label>
      <div >
	<div CLASS="table-responsive">
	  <table class="table table-striped  table-bordered table-hover custom-tbl-st bt" id="rules_table">
	    <thead>
	      <tr class="item">
		<th>Location</th>
		<th>Condition</th>
		<th>URL</th>
		<th>Flag</th>
		<th>Proxy Pass</th>
		<th colspan="2" align="center">Actions</th>
		</tr>
	      </thead>
	    <tbody id="link_items">
	      
	        </tbody>
	    </table>
	  <span style="float:right;font-size:12px;font-style:italic;color:#d9534f">Note: Please submit the form to save the changes!</span>
	  </div>
	
	</div>
      </div>
    </div>
  <div class="col-sm-12 margin-top-15 " align="CENTER">
                <input class="btn btn-primary btn-color margin-right-5 btn-sm " value="Submit" type="submit">  
                </div>
   </div>
	      
             
	      </div>
             
             </form>
   </section>
   <div class="modal fade" id="hostDetailsModules" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
                <button type="button" class="close" 
                   data-dismiss="modal" onClick="resetHostForm()">
                       <span aria-hidden="true">&times;</span>
                       <span class="sr-only">Close</span>
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    Describe Host details
                </h4>
            </div>
	    
	    <style>
	      .form-group {
	      margin-bottom: 15px;
	      overflow: hidden;
	      }
	      </style>
            
            <!-- Modal Body -->
            <div class="modal-body">
              <div class="form-group" id="hostMessageId">
                    <label for="item_label"><strong>Host Name</strong><span class="f_req">*</span></label>
                      <input class="form-control" id="item_host_name" placeholder="Enter Host Name"/>
                      <input type="hidden" class="form-control" id="host_uuid"/>
                  </div>
                  
                  <div class="form-group">
                    <label for="item_type" id="itemlinklabel"><strong>IP Address</strong></label>
                     <input class="form-control" id="host_ip" placeholder="Enter IP Address"/>
                  </div>
                  <div class="form-group">
                    <label for="item_type" id="itemlinklabel"><strong>Index</strong><span class="f_req">*</span></label>
                     <input class="form-control" id="host_index" placeholder="Enter index"/>
                  </div>
                   <div class="form-group">
                    <label for="item_type" id="itemlinklabel"><strong>Port</strong><span class="f_req">*</span></label>
                     <input class="form-control" id="host_port" placeholder="Enter Port"/>
                  </div>
                  <div class="form-group">
                    <label><strong><input  id="host_redirect_to_https" value="1" type="checkbox">&nbsp;Redirect to HTTPS</strong></label>
                  </div>
                  <div class="form-group">
                    <label for="item_type" id="itemlinklabel"><strong>Root Path</strong><span class="f_req">*</span></label>
                     <input class="form-control" id="host_root_path" placeholder=""/>
                  </div>
                   <div class="form-group">
                    <label for="item_type" id="itemlinklabel"><strong>Access Log Path</strong></label>
                     <input class="form-control" id="host_access_log_path" placeholder=""/>
                  </div>
                  <div class="form-group">
                    <label for="item_type" id="itemlinklabel"><strong>Error Log Path</strong></label>
                     <input class="form-control" id="host_error_log_path" placeholder=""/>
                  </div>
            </div>
            
            <!-- Modal Footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" onClick="resetHostForm()">
                  Close
                </button>
                <button type="button" class="btn btn-primary" onClick="createHostRow()">
                    Add
                </button>
            </div>
        </div>
    </div>
   </div>
 
  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
                <button type="button" class="close" 
                   data-dismiss="modal" onClick="resetItemForm()">
                       <span aria-hidden="true">&times;</span>
                       <span class="sr-only">Close</span>
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    Describe Rule
                </h4>
            </div>
	    
	    <style>
	      .form-group {
	      margin-bottom: 15px;
	      overflow: hidden;
	      }
	      </style>
            
            <!-- Modal Body -->
            <div class="modal-body">
              <div class="form-group" id="messageId">
                    <label for="item_label"><strong>Location</strong><span class="f_req">*</span></label>
                      <input class="form-control" id="item_location" placeholder="Enter location"/>
                      <input type="hidden" class="form-control" id="item_uuid"/>
                  </div>
                  
                  <div class="form-group">
                    <label for="item_type" id="itemlinklabel"><strong>Condition</strong><span class="f_req">*</span></label>
                     <input class="form-control" id="item_regex" placeholder="Enter Regex"/>
                  </div>
                  
                  <div class="form-group">
                    <label for="item_type" id="itemlinklabel" class="col-md-12" style="padding-left:0px;"><strong>URL</strong><span class="f_req">*</span></label>
                    <input class="form-control" id="item_url" placeholder="Enter URL"/>
                  </div>
                  <div class="form-group" style="margin-top:5px;">
                 <label >   <span for="item_type"><strong>Flag</strong></span></label>
                 <input type="" class="form-control" id="item_flag" value="last"/>
                  </div>
                 <div class="form-group" style="margin-top:5px;">
                 <label >   <span for="item_type"><strong>Proxy Pass</strong></span></label>
                 <input type="" class="form-control" id="item_proxy_pass" value=""/>
                  </div>
            </div>
            
            <!-- Modal Footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" onClick="resetItemForm()">
                  Close
                </button>
                <button type="button" class="btn btn-primary" onClick="savelinkitem()">
                    Add
                </button>
            </div>
        </div>
    </div>
  </div>
        <!-- right col -->
      </div>
      <!-- /.row (main row) -->

    </section>

  </div>
	<footer class="main-footer">
	    <strong>Copyright &copy; 2016-2017 <a href="http://www.synergist.co.uk" target="_blank">Synergist</a>.</strong> All rights reserved.
  	</footer>
</div>
<script src="js/jquery-2.2.3.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/jquery.validate.js"></script>
<script type="text/javascript">
function resetHostForm(){
	$("#hostMsgSpan").remove();
	$('#host_ip').val('');
	$('#item_host_name').val('');
	$('#host_uuid').val('');
	$('#host_index').val('');
	$('#host_port').val('');
	$('#host_redirect_to_https').prop('checked', false);
	$('#host_root_path').val('');
	$('#host_access_log_path').val('');
	$('#host_error_log_path').val('');
}
function generateHostsObjectJson(){
	var createArr=new Array();
	var i=0;
	$('.hostItemClass').each(function(){
		var createObject={};
		createObject['uuid']=$(this).find('#uuid').val();
		createObject['host_name']=$(this).find('#host_name').val();
		createObject['ip_address']=$(this).find('#ip_address').val();
		createObject['index']=$(this).find('#index').val();
		createObject['port']=$(this).find('#port').val();
		createObject['redirect_to_https']=$(this).find('#redirect_to_https').val();
		createObject['root_path']=$(this).find('#root_path').val();
		createObject['access_log_path']=$(this).find('#access_log_path').val();
		createObject['error_log_path']=$(this).find('#error_log_path').val();
		createArr[i]=createObject;
		i++;
	});
	$("#hosts").val(JSON.stringify(createArr));
}
function generateRulesObjectJson(){
	var createArr=new Array();
	var i=0;
	$('.itemClass').each(function(){
		var createObject={};
		createObject['uuid']=$(this).find('#uuid').val();
		createObject['location']=$(this).find('#location').val();
		createObject['regex']=$(this).find('#regex').val();
		createObject['url']=$(this).find('#url').val();
		createObject['flag']=$(this).find('#flag').val();
		createObject['proxy_pass']=$(this).find('#proxy_pass').val();
		createArr[i]=createObject;
		i++;
	});
	$("#rules").val(JSON.stringify(createArr));
}

function resetItemForm(){
	$("#msgSpan").remove();
	$('#item_location').val('');
	$('#item_uuid').val('');
	$('#item_regex').val('');
	$('#item_url').val('');
	$('#item_flag').val('last');
	$('#item_proxy_pass').val('');
}
function remove_host_item(e){
	if(e!=""){
		$(".hosttr_"+e).closest('tr').remove();
	}
}
function remove_item(e){
	if(e!=""){
		$(".itemtr_"+e).closest('tr').remove();
	}
}
function edit_item(e){
	if(e!=""){
		var row= $(".itemtr_"+e).closest('tr');
		$("#item_uuid").val(e);
		$("#item_location").val(row.find('#location').val());
		$("#item_regex").val(row.find('#regex').val());
		$("#item_url").val(row.find('#url').val());
		$("#item_flag").val(row.find('#flag').val());
		$("#item_proxy_pass").val(row.find('#proxy_pass').val());
		$('#myModal').modal('show'); 
	}
}
function edit_host_item(e){
	if(e!=""){
		var row= $(".hosttr_"+e).closest('tr');
		$("#host_uuid").val(e);
		$("#item_host_name").val(row.find('#host_name').val());
		$("#host_ip").val(row.find('#ip_address').val());
		$("#host_index").val(row.find('#index').val());
		if(row.find('#redirect_to_https').val()==1){
			$("#host_redirect_to_https").prop('checked', true);
		}
		
		$("#host_port").val(row.find('#port').val());
		$("#host_root_path").val(row.find('#root_path').val());
		$("#host_access_log_path").val(row.find('#access_log_path').val());
		$("#host_error_log_path").val(row.find('#error_log_path').val());
		$('#hostDetailsModules').modal('show'); 
	}
}
function createHostRow(){
	$("#hostMsgSpan").remove();
	if($('#item_host_name').val()!="" && $('#host_index').val()!="" && $('#host_port').val()!="" && $('#host_root_path').val()!=""){
		var uuidStr=$("#host_uuid").val();
		if(uuidStr==""){
			uuidStr = guid();
		}
		var contentStr="<td><input type='hidden' id='uuid' value='"+uuidStr+"'><input type='hidden' id='host_name' value='"+$('#item_host_name').val()+"'>"+$('#item_host_name').val()+"</td>";
		contentStr+="<td><input type='hidden' id='ip_address' value='"+$('#host_ip').val()+"'>"+$('#host_ip').val()+"</td>";
		contentStr+="<td><input type='hidden' id='index' value='"+$('#host_index').val()+"'>"+$('#host_index').val()+"</td>";
		contentStr+="<td><input type='hidden' id='port' value='"+$('#host_port').val()+"'>"+$('#host_port').val()+"</td>";
		var host_redirect_to_https=0;
		if($('#host_redirect_to_https').is(":checked")){
			host_redirect_to_https=1;
		}
		contentStr+="<td><input type='hidden' id='redirect_to_https' value='"+host_redirect_to_https+"'>"+host_redirect_to_https+"</td>";
		contentStr+="<td><input type='hidden' id='root_path' value='"+$('#host_root_path').val()+"'>"+$('#host_root_path').val()+"</td>";
		contentStr+="<td><input type='hidden' id='access_log_path' value='"+$('#host_access_log_path').val()+"'>"+$('#host_access_log_path').val()+"</td>";
		contentStr+="<td><input type='hidden' id='error_log_path' value='"+$('#host_error_log_path').val()+"'>"+$('#host_error_log_path').val()+"</td>";
		
		contentStr+='<td><a href="javascript:void(0)" title="Edit" onClick="edit_host_item(\''+uuidStr+'\')"><i class="fa fa-pencil"></i></a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:void(0)" onClick="remove_host_item(\''+uuidStr+'\')" title="Remove"><i class="fa fa-trash"></i></a></td>';

		if($("#host_uuid").val()!=""){
			$(".hosttr_"+uuidStr).html(contentStr);
		}else{
			$("#host_items").append("<tr class='hostItemClass hosttr_"+uuidStr+"'>"+contentStr+"</tr>");
		}
		$('#hosts_table').basictable('destroy');
		$('#hosts_table').basictable({
			breakpoint: 751
		});
		$('#hostDetailsModules').modal('hide');
		resetHostForm();
	} else{ 
		$("#hostMessageId").before('<span id="hostMsgSpan" style="color:#CC0000;">Please add all the required fields!</span>');
	}
}
function savelinkitem (){
	$("#msgSpan").remove();
	if($('#item_location').val()!="" && $('#item_regex').val()!="" && $('#item_url').val()!=""){
		var uuidStr=$("#item_uuid").val();
		if(uuidStr==""){
			uuidStr = guid();
		}
		var contentStr="<td><input type='hidden' id='uuid' value='"+uuidStr+"'><input type='hidden' id='location' value='"+$('#item_location').val()+"'>"+$('#item_location').val()+"</td>";
		contentStr+="<td><input type='hidden' id='regex' value='"+$('#item_regex').val()+"'>"+$('#item_regex').val()+"</td>";
		contentStr+="<td><input type='hidden' id='url' value='"+$('#item_url').val()+"'>"+$('#item_url').val()+"</td>";
		contentStr+="<td><input type='hidden' id='flag' value='"+$('#item_flag').val()+"'>"+$('#item_flag').val()+"</td>";
		contentStr+="<td><input type='hidden' id='proxy_pass' value='"+$('#item_proxy_pass').val()+"'>"+$('#item_proxy_pass').val()+"</td>";
		contentStr+='<td><a href="javascript:void(0)" title="Edit" onClick="edit_item(\''+uuidStr+'\')"><i class="fa fa-pencil"></i></a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:void(0)" onClick="remove_item(\''+uuidStr+'\')" title="Remove"><i class="fa fa-trash"></i></a></td>';
		if($("#item_uuid").val()!=""){
			$(".itemtr_"+uuidStr).html(contentStr);
		}else{
			$("#link_items").append("<tr class='itemClass itemtr_"+uuidStr+"'>"+contentStr+"</tr>");
		}
		$('#rules_table').basictable('destroy');
		$('#rules_table').basictable({
			breakpoint: 751
		});
		$('#myModal').modal('hide');
		resetItemForm();
	} else{ 
		$("#messageId").before('<span id="msgSpan" style="color:#CC0000;">Please add all the required fields!</span>');
	}
}
function guid() {
  function s4() {
    return Math.floor((1 + Math.random()) * 0x10000)
      .toString(16)
      .substring(1);
  }
  return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
    s4() + '-' + s4() + s4() + s4();
}
function getUrlVars() {
    var vars = {};
    var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,    
    function(m,key,value) {
      vars[key] = value;
    });
    return vars;
}
function generate_manual_code(name,code){
	var val=$("#"+name).val();
	var patt=/[^A-Za-z0-9_-]/g;
	var result=val.replace(patt,' ');
	result=result.replace(/-/g, ' ');
	result=result.replace(/\s+/g, ' ');
	result = result.replace(/^\s+|\s+$/g,'');
	result=result.replace(/\s/g, '-');
	result=result.toLowerCase();
	$("#"+code).val(result);
}
$(document).ready(function() {
	$(".host_details_class").show();
	if(getUrlVars() && getUrlVars()["code"]  && getUrlVars()["code"]!="") {
		$("#code").val(getUrlVars()["code"]);
		$.getJSON("https://dev.synergist.cloud/api_get_key?key=site:"+getUrlVars()["code"],function(result){
			if(result.success && result.aaData && result.aaData.length>0){
				$("#pageHeadingID").html("Edit");
				var aaDataStr= result.aaData;
				var aaDataObj = JSON.parse(aaDataStr);
				$.each(aaDataObj, function(key,value){
					if(key=="rules"){
						var contentStr='';
						$.each(JSON.parse(value), function(i,row){
							var uuidStr=guid();
							if(row.uuid && row.uuid!=""){
								uuidStr= row.uuid;
							}
							contentStr+="<tr class='itemClass itemtr_"+uuidStr+"'><td><input type='hidden' id='uuid' value='"+uuidStr+"'><input type='hidden' id='location' value='"+row.location+"'>"+row.location+"</td>";
    						contentStr+="<td><input type='hidden' id='regex' value='"+row.regex+"'>"+row.regex+"</td>";
    						contentStr+="<td><input type='hidden' id='url' value='"+row.url+"'>"+row.url+"</td>";
    						contentStr+="<td><input type='hidden' id='flag' value='"+row.flag+"'>"+row.flag+"</td>";
							contentStr+="<td><input type='hidden' id='proxy_pass' value='"+row.proxy_pass+"'>"+row.proxy_pass+"</td>";
    						contentStr+='<td><a href="javascript:void(0)" title="Edit" onClick="edit_item(\''+uuidStr+'\')"><i class="fa fa-pencil"></i></a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:void(0)" onClick="remove_item(\''+uuidStr+'\')" title="Remove"><i class="fa fa-trash"></i></a></td></tr>';
						});
						$("#link_items").html(contentStr);
					} else if(key=="hosts") {
						var contentStr='';
						$.each(JSON.parse(value), function(i,row){
							var uuidStr=guid();
							if(row.uuid && row.uuid!=""){
								uuidStr= row.uuid;
							}
							contentStr+="<tr class='hostItemClass hosttr_"+uuidStr+"'><td><input type='hidden' id='uuid' value='"+uuidStr+"'><input type='hidden' id='host_name' value='"+row.host_name+"'>"+row.host_name+"</td>";
    						contentStr+="<td><input type='hidden' id='ip_address' value='"+row.ip_address+"'>"+row.ip_address+"</td>";
    						contentStr+="<td><input type='hidden' id='index' value='"+row.index+"'>"+row.index+"</td><td><input type='hidden' id='port' value='"+row.port+"'>"+row.port+"</td>";
    						contentStr+="<td><input type='hidden' id='redirect_to_https' value='"+row.redirect_to_https+"'>"+row.redirect_to_https+"</td>";
							contentStr+="<td><input type='hidden' id='root_path' value='"+row.root_path+"'>"+row.root_path+"</td>";
							contentStr+="<td><input type='hidden' id='access_log_path' value='"+row.access_log_path+"'>"+row.access_log_path+"</td>";
							contentStr+="<td><input type='hidden' id='error_log_path' value='"+row.error_log_path+"'>"+row.error_log_path+"</td>";
   							contentStr+='<td><a href="javascript:void(0)" title="Edit" onClick="edit_host_item(\''+uuidStr+'\')"><i class="fa fa-pencil"></i></a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:void(0)" onClick="remove_host_item(\''+uuidStr+'\')" title="Remove"><i class="fa fa-trash"></i></a></td></tr>';
						});
						$("#host_items").html(contentStr);
					} else{
						$("#"+key).val(value);
					}
				});
			}
			$('#rules_table').basictable({
				breakpoint: 751
			});
			$('#hosts_table').basictable({
				breakpoint: 751
			});
		});
	}
    $("#EntryForm").validate({
		ignore: "",
		onkeyup: false,
		errorClass: 'error',
		validClass: 'valid',
		errorElement: "em",
		errorPlacement: function(error, element) {
			$(element).closest('div').append(error);
		},
		onfocusout: false,
		invalidHandler: function(form, validator) {
			var errors = validator.numberOfInvalids();
			if (errors) {                    
				validator.errorList[0].element.focus();
			}
		},
		rules: {
			name: { required: true },
			code: { required: true }
		},
		submitHandler: function(form) {
			generateRulesObjectJson();
			generateHostsObjectJson();
			var tokenStr=$("#uuid").val();
			if(tokenStr=="") {
				var tokenStr=guid();
				$("#uuid").val(tokenStr);
			}
			var entry_form_data_obj = dataAsJson("EntryForm");
			$.ajax({
				url: 'https://dev.synergist.cloud/api_set_site',
				type: 'GET',
				data: {"value" : JSON.stringify(entry_form_data_obj), "code" : $("#code").val()},
				contentType: false,
				dataType: 'json',
				success: function(response){
					if(response.success){
						window.location.href = "/site.html?code="+$("#code").val()+"&"+Math.random();
					} else if(response.error) {
						$('#EntryForm').before('<div class="alert alert-error alert-dismissable uploadFile"><button aria-hidden="true" data-dismiss="alert" class="close" type="button">×</button>'+response.error+'</div>');
					}else {
						$('#EntryForm').before('<div class="alert alert-error alert-dismissable uploadFile"><button aria-hidden="true" data-dismiss="alert" class="close" type="button">×</button>Sorry, error while saving details!</div>');
					}
				}
			});
		}
	});
});
	function dataAsJson(name){
		var x = $("#"+name).serializeArray();
		var outputObj = new Object();
    	$.each(x, function(i, field){
    		if(field.value!=""){
    			outputObj[field.name]   = field.value;
    		}
     	});
    	return outputObj;
    }
</script>
<script src="js/basictable.js"></script>
<script src="js/app.min.js"></script>
</body>
</html>